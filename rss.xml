<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Jason Lam]]></title><description><![CDATA[慎獨｜純亦不已]]></description><link>https://lumen.netlify.com</link><generator>RSS for Node</generator><lastBuildDate>Thu, 01 Nov 2018 08:25:38 GMT</lastBuildDate><item><title><![CDATA[重磅：React Hooks]]></title><description><![CDATA[React v16.7.0-alpha 後引入了「Hooks」此一向後兼容之概念。本文詳盡地介紹了 Hooks 的誕生背景、使用方法與情境。]]></description><link>https://lumen.netlify.com/posts/react-hooks/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/react-hooks/</guid><pubDate>Sat, 27 Oct 2018 22:40:32 GMT</pubDate><content:encoded>&lt;p&gt;React v16.7.0-alpha 後引入了「Hooks」此一向後兼容之概念。&lt;/p&gt;
&lt;h2&gt;背景介紹&lt;/h2&gt;
&lt;p&gt;隨著 React 應用長期擴展和維護，終會引致以下所謂「unconnected」問題，而 Hooks 因應而生：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;難以復用組件間的富狀態邏輯&lt;/strong&gt;：React 無法為組件連結可復用的行為。Render props 和 HOC 是解決之道，但你需要重構代碼以使用之。Hooks 便是 React 所亟需的、一個用以共享富狀態（stateful）邏輯的原生手段。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;複雜組件變得難以理解&lt;/strong&gt;：互有關聯的邏輯分散支離於不同生命週期，而同一生命週期又充斥著互無關聯的代碼。Hooks 能讓一組件基於關係地分割成小函式（譬如基於抓取數據一塊），你或可使用一 reducer 來使組件本地 state 更加可預測。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;令人困惑的 class&lt;/strong&gt;：囿於 JavaScript 本身特性，class 組件常令人困惑，尤其是涉及對class 組件或函式組件的選擇時。Class 組件對機器層面亦有影響，譬如難以 minify、使熱加載變慢或不穩定，還會影響極有潛力的 &lt;a href=&quot;https://en.wikipedia.org/wiki/Ahead-of-time_compilation&quot;&gt;ahead-of-time compilation&lt;/a&gt; 的速度。Hooks 擁抱函式，能在沒有 class 的情況下，充分利用 React 特性。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;React 不鼓勵開發者急於改寫現有代碼，而是逐漸轉換思想，即「thinking in Hooks」。Hooks 能覆蓋 class 的所有使用場景，但仍會保留 class。&lt;/p&gt;
&lt;h2&gt;Hooks 用法&lt;/h2&gt;
&lt;p&gt;以下代碼示例片段，默認發生於此函式之內：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; useEffect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;State Hooks&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;useState&lt;/code&gt; 是一個 Hook。在函式組件內調用它（傳參為初始 state 值），會返回新增的本地 state、以及用以更新該 state 的函式：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setCount&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 初始值為 0 的新 state，返回該 state 和更新函式&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;上例之 &lt;code class=&quot;language-text&quot;&gt;setCount&lt;/code&gt; 和 class 裏的 &lt;code class=&quot;language-text&quot;&gt;this.setState&lt;/code&gt; 相似，除了它&lt;strong&gt;不合併新舊 state，而是直接替代&lt;/strong&gt;——此即為 Hooks 的初衷，即提倡基於哪些 state 會一道改變來分割 state（並因之分割 Hooks），故直接替代 state 值而非合併一龐雜的 state 對象。&lt;/p&gt;
&lt;h3&gt;Effect Hooks&lt;/h3&gt;
&lt;p&gt;諸如抓取數據、訂閱和手動操作 DOM 這些行為，皆是「副作用」（簡稱「effects」）。我們通常想副作用發生於 React 更新 DOM 之後，譬如把基於 state 的 DOM 手動操作放在 &lt;code class=&quot;language-text&quot;&gt;componentDidMount&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;componentDidUpdate&lt;/code&gt; 生命週期中，而這導致重複代碼。&lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt; 此一 Hook，發揮並結合了 class 裏的各生命週期的用處，能在函式組件發生渲染之後執行副作用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`You clicked &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;count&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; times`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;副作用還能透過返回一個函式，以指定 React 於組件卸載時「清理」之：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribeToFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsubscribeFromFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Effects 實踐貼士&lt;/h4&gt;
&lt;p&gt;在一函式組件內結合調用多個 &lt;code class=&quot;language-text&quot;&gt;useState&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt;，將無關的邏輯分離至多個代碼塊：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setCount&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`You clicked &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;count&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; times`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;isOnline&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setIsOnline&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribeToFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsubscribeFromFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt; 在每次重渲染時都觸發的原因是：在 class 組件中，使用到 props 的副作用在 props 變動時會引致 bug，除非正確引入 &lt;code class=&quot;language-text&quot;&gt;componentDidUpdate&lt;/code&gt;（which is 一常見的 bug 來源）以監測 props。&lt;/p&gt;
&lt;p&gt;為優化性能，可擇機取消重渲染後觸發 &lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt;。不同於 &lt;code class=&quot;language-text&quot;&gt;componentDidUpdate&lt;/code&gt; 中比對 &lt;code class=&quot;language-text&quot;&gt;prevProps&lt;/code&gt; 參數和當前 props（或 &lt;code class=&quot;language-text&quot;&gt;prevState&lt;/code&gt; 和當前 state），&lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt; 內建可選的第二個參數：包含 state 名的數組，於是僅在該 state 變化時才重跑 effect。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`You clicked &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;count&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; times`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribeToFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsubscribeFromFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Hooks 之規則&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;只在&lt;strong&gt;頂層&lt;/strong&gt;調用 Hooks。勿在循環、條件或嵌套函式內調用。&lt;/li&gt;
&lt;li&gt;只在 React 函式組件內調用 Hooks。勿在常規 JavaScript 函式內調用（除了 custom Hooks，後文將述及）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;官方提供一 &lt;a href=&quot;https://www.npmjs.com/package/eslint-plugin-react-Hooks&quot;&gt;eslint-plugin-react-hooks&lt;/a&gt; 來確保這些規則。&lt;/p&gt;
&lt;h3&gt;Custom Hooks&lt;/h3&gt;
&lt;p&gt;自訂 Hooks 讓你能復用富狀態邏輯，而不似 render props 和 HOC 那般徒增新組件。&lt;/p&gt;
&lt;p&gt;將訂閱好友在線狀態的邏輯抽取出來成為一自訂 Hook：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;friendID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;isOnline&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setIsOnline&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleStatusChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;setIsOnline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isOnline&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    ChatAPI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribeToFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;friendID&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleStatusChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* unsubscribe */&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; isOnline&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;然後就可在多個組件中使用之：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; isOnline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isOnline &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Loading...&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; isOnline &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Online&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Offline&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FriendListItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; isOnline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useFriendStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;li style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; color&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; isOnline &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;green&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;black&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;friend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;li&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;須知自訂 Hooks 只復用邏輯而非 state，調用者仍有完全孤立的 state。自訂 Hooks 更似一個自然流露的 convention 而非 feature，若一個函式以「&lt;code class=&quot;language-text&quot;&gt;use&lt;/code&gt;」冠名並其內部調用了其他 Hooks，則為一自訂 Hook。諸如表單處理、動畫、訂閱聲明、定時器等行為，皆可利用自訂 Hooks。&lt;/p&gt;
&lt;h3&gt;其他 Hooks&lt;/h3&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;useContext&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;此 Hook 讓你毋須引入嵌套即可訂閱 React context：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; locale &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LocaleContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; theme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ThemeContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;開發者通常不樂意手動地在組件樹中層層傳遞回調函式。可以結合 &lt;code class=&quot;language-text&quot;&gt;useReducer&lt;/code&gt;（下文會述及）和 context 來往下傳遞一 &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; TodosDispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TodosApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Tip: `dispatch` won&apos;t change between re-renders&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todosReducer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TodosDispatch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;DeepTree todos&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TodosDispatch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;TodosApp&lt;/code&gt; 內的任意子裔都可以讀取使用 &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt; 函數並發起 actions 至 &lt;code class=&quot;language-text&quot;&gt;TodosApp&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DeepChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 從 context 處取用 dispatch 來執行 action&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dispatch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TodosDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;add&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;hello&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;handleClick&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Add todo&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;useReducer&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;此 Hook 是 &lt;code class=&quot;language-text&quot;&gt;useState&lt;/code&gt; 的替代，可用一 reducer 管理複雜組件的本地 state。它接收一 reducer 和一可選的 &lt;code class=&quot;language-text&quot;&gt;initialState&lt;/code&gt;，返回當前 state 併以一 &lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt; 方法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reset&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;increment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;decrement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; initialCount &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;reducer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      Count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reset&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        Reset
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;increment&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;decrement&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;useMemo&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; memoizedValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;computeExpensiveValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;返回一個記憶化的（memoized）值。只會在輸入參數時發生改變時觸發重計算，避免每次渲染後的計算開銷。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;useMemo&lt;/code&gt; 甚至可用來跳過對子組件的重渲染：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Parent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 僅當 `a` 變化時重渲染：&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; child1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Child1 a&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 僅當 `b` 變化時重渲染：&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; child2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Child2 b&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;child1&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;child2&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;useCallback&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; memoizedCallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;返回一個記憶化的回調函式，它只會在輸入參數發生改變時觸發。引用比較的子組件會引致不必要的渲染，&lt;code class=&quot;language-text&quot;&gt;useCallback&lt;/code&gt; 即能用於優化此情境（類似 &lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt;）。&lt;/p&gt;
&lt;h4&gt;&lt;code class=&quot;language-text&quot;&gt;useRef&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TextInputWithFocusButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; inputEl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;onButtonClick&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// `current` 指向加載的輸入框元素&lt;/span&gt;
    inputEl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;focus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input ref&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;inputEl&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;onButtonClick&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Focus the input&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;一個小技巧：&lt;code class=&quot;language-text&quot;&gt;useRef&lt;/code&gt; 可用以保存實例變量，因為「ref」對象是一個通用的容器，而其 &lt;code class=&quot;language-text&quot;&gt;current&lt;/code&gt; 成員是可變的（mutable）並能貯存任意值，類似 class 的實例變量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Timer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; intervalRef &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    intervalRef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;clearInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;intervalRef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleCancelClick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;clearInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;intervalRef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[React 狀態管理模式]]></title><description><![CDATA[如果你的 React 應用沒有用上恰當的狀態管理模式，開發會變得非常辛苦。]]></description><link>https://lumen.netlify.com/posts/react-state-patterns</link><guid isPermaLink="false">https://lumen.netlify.com/posts/react-state-patterns</guid><pubDate>Sat, 01 Sep 2018 22:40:32 GMT</pubDate><content:encoded>&lt;h2&gt;狀態定義&lt;/h2&gt;
&lt;p&gt;React 應用有四種不同的狀態：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1-6296f8fbed07ffbee8371d8db1a53bac-36541.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 38.6034255599473%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3gQH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEhEVH/2gAIAQEAAT8hpyCeH//aAAwDAQACAAMAAAAQA8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhMWH/2gAIAQEAAT8QKK12I6xXYIpfZ//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;React 應用的四種狀態&quot;
        title=&quot;&quot;
        src=&quot;/static/1-6296f8fbed07ffbee8371d8db1a53bac-d564d.jpg&quot;
        srcset=&quot;/static/1-6296f8fbed07ffbee8371d8db1a53bac-865fd.jpg 240w,
/static/1-6296f8fbed07ffbee8371d8db1a53bac-d40a0.jpg 480w,
/static/1-6296f8fbed07ffbee8371d8db1a53bac-d564d.jpg 960w,
/static/1-6296f8fbed07ffbee8371d8db1a53bac-c67c1.jpg 1440w,
/static/1-6296f8fbed07ffbee8371d8db1a53bac-36541.jpg 1518w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全局狀態：在組件樹外部維護的狀態，典型者為 Redux。此處的狀態能為應用中任意一處所訪問。&lt;/li&gt;
&lt;li&gt;組件狀態：在組件（container）中透過 &lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt; 持有並維護的狀態。&lt;/li&gt;
&lt;li&gt;相對狀態：從父組件傳至子組件的狀態。&lt;/li&gt;
&lt;li&gt;供給狀態：被一個 provider 置入上下文（使用 React 的 Context API）的狀態，能被組件單獨取用而毋須在組件樹中傳遞。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Pattern 1: Prop-drilling&lt;/h2&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2-42bc63fa303ac73efe0ca5ee07531f08-5a92a.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 778px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 82.51928020565552%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9OimCAAf/EABUQAQEAAAAAAAAAAAAAAAAAACAR/9oACAEBAAEFAjR//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBABAQACAgMAAAAAAAAAAAAAAQAhMRBBEVGB/9oACAEBAAE/IVz4jHA+7qAbbr5M7b//2gAMAwEAAgADAAAAEGMAAP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABwQAQADAAIDAAAAAAAAAAAAAAEAEUEhMVFxof/aAAgBAQABPxDyBHVRXnYNlwLWnPUEsNXkAoLmJ16J9U//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Prop-drilling pattern&quot;
        title=&quot;&quot;
        src=&quot;/static/2-42bc63fa303ac73efe0ca5ee07531f08-5a92a.jpg&quot;
        srcset=&quot;/static/2-42bc63fa303ac73efe0ca5ee07531f08-c34a1.jpg 240w,
/static/2-42bc63fa303ac73efe0ca5ee07531f08-ecebb.jpg 480w,
/static/2-42bc63fa303ac73efe0ca5ee07531f08-5a92a.jpg 778w&quot;
        sizes=&quot;(max-width: 778px) 100vw, 778px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;這是最為常見的模式。其理念是僅有 containers（smart components）負責創建狀態，也僅有它們可以取用全局 store 的狀態。它們能透過 &lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt; 創建其自己的狀態，並用 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt; 傳給組件樹。&lt;/p&gt;
&lt;p&gt;當全局狀態需要變化，該變化會在 container 處激發（如 Redux 的 dispatch 一個 action）。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3-88cea6468c895e2b7f06eed880695750-5a92a.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 778px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 82.51928020565552%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9OimCAAf/EABUQAQEAAAAAAAAAAAAAAAAAACAR/9oACAEBAAEFAjR//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAFBABAAAAAAAAAAAAAAAAAAAAMP/aAAgBAQAGPwIf/8QAHBABAQACAgMAAAAAAAAAAAAAAQAhMRARQVHR/9oACAEBAAE/IVz1GOB93iAbb5M7b//aAAwDAQACAAMAAAAQIwAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARIUExcaH/2gAIAQEAAT8Qs0TI6qK72DZcC1pviCWGr5AKCycJ69E+qf/Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Prop-drilling pattern: 全局狀態的變動只能發生在 container&quot;
        title=&quot;&quot;
        src=&quot;/static/3-88cea6468c895e2b7f06eed880695750-5a92a.jpg&quot;
        srcset=&quot;/static/3-88cea6468c895e2b7f06eed880695750-c34a1.jpg 240w,
/static/3-88cea6468c895e2b7f06eed880695750-ecebb.jpg 480w,
/static/3-88cea6468c895e2b7f06eed880695750-5a92a.jpg 778w&quot;
        sizes=&quot;(max-width: 778px) 100vw, 778px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;這個模式有三種類型的狀態：全局狀態、組件狀態及相對狀態。&lt;/p&gt;
&lt;p&gt;優點在於職責定義清晰。我們知道全局狀態的變動只能發生在 container，而組件接收的狀態只能來自於 container。&lt;/p&gt;
&lt;p&gt;缺點來自相對狀態。當傳遞多於兩層時，就會變得混亂。&lt;/p&gt;
&lt;h2&gt;Pattern 2: Redux-centric&lt;/h2&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4-9f01d8f50014d049eb981b2a0f423f07-1f7c9.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 81.67938931297711%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9Gi0D/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAQEBAAAAAAAAAAAAAAAAAREhQVH/2gAIAQEAAT8hb0WeiL0pYf/aAAwDAQACAAMAAAAQcN//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAADAQEAAwAAAAAAAAAAAAAAAREhMVFhof/aAAgBAQABPxDgdh4noaoSWtvwhW7d4JMOuej/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Redux-centric pattern&quot;
        title=&quot;&quot;
        src=&quot;/static/4-9f01d8f50014d049eb981b2a0f423f07-1f7c9.jpg&quot;
        srcset=&quot;/static/4-9f01d8f50014d049eb981b2a0f423f07-c0b80.jpg 240w,
/static/4-9f01d8f50014d049eb981b2a0f423f07-05f89.jpg 480w,
/static/4-9f01d8f50014d049eb981b2a0f423f07-1f7c9.jpg 786w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;與前一個模式不同之處在於，dumb components 現在不那麼 dumb 了。它們能自己訪問到全局狀態，而毋需 Container 傳遞。&lt;/p&gt;
&lt;p&gt;但這帶來的壞處是模糊了職責的定義，現在 container 和 dumb components 皆能自行訪問全局狀態；dumb components 何時應接收相對狀態、何時應使用全局狀態亦不明確。&lt;/p&gt;
&lt;p&gt;最重要的是，全局狀態並不遵循 React 組件的生命週期。如果使用相對狀態模式，當 container 卸載時，其狀態會重置，意味著從 container 接收數據的組件不再擁有那些 props。但是如果該組件是從全局拉取其狀態的，而當其卸載時，該狀態仍存在於全局。當它重新掛載時，將會收到如舊的數據。這通常引致 bug。組件現在與相關的全局狀態緊密耦合了，降低其復用性。&lt;/p&gt;
&lt;p&gt;一個方法是在組件卸載時重置該部分全局狀態。但這也說明了如果需要這樣做，或許更宜使用組件內的狀態。&lt;/p&gt;
&lt;h2&gt;Pattern 3: Provided State&lt;/h2&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5-530c3e0b12f5045ea70503318fc0944a-a7a74.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 816px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 72.4264705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35Ckj//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAIDAQAAAAAAAAAAAAAAAAARARAhQf/aAAgBAQABPyGSMp9GhrD/2gAMAwEAAgADAAAAEHMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAIDAQEAAAAAAAAAAAAAAQAhETFBUWH/2gAIAQEAAT8QTotgU4O3cHJkldNz4F3Hm15P/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Provided state pattern&quot;
        title=&quot;&quot;
        src=&quot;/static/5-530c3e0b12f5045ea70503318fc0944a-a7a74.jpg&quot;
        srcset=&quot;/static/5-530c3e0b12f5045ea70503318fc0944a-e5b4f.jpg 240w,
/static/5-530c3e0b12f5045ea70503318fc0944a-220ea.jpg 480w,
/static/5-530c3e0b12f5045ea70503318fc0944a-a7a74.jpg 816w&quot;
        sizes=&quot;(max-width: 816px) 100vw, 816px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;React v16.3 後正式支援 Context API。每個 context 都有一個 &lt;code class=&quot;language-text&quot;&gt;provider&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;consumer&lt;/code&gt;。在上圖中，Containers 是 context 的 providers，而 Components 是 consumers。Containers 能從全局狀態中承繼 state，亦能自己創造 state 並「provide」予 context。然後 Components 能從 context 中挑揀所需的 props，而毋須依賴 container 或全局狀態。&lt;/p&gt;
&lt;p&gt;這種分工類似於 pattern 1——containers 是唯一能操縱並使用全局狀態的組件，components 只從 context 處獲取 props 並展現之。&lt;/p&gt;
&lt;p&gt;這種模式解決了之前的問題：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;由於 component 能從 context 處獲取其所需的任意內容，毋須從 container 傳遞，雖然一定程度上還需要組件間的相對狀態，但完全消弭了 prop-drilling 問題。&lt;/li&gt;
&lt;li&gt;毋須再顧慮 component 位於組件樹中的何處，增強了復用性。在 pattern 1 中，一旦 component 被置於組件樹中並接收 props，它就不能被隨意移動——除非重構其 props 來源。&lt;/li&gt;
&lt;li&gt;每個 context state 都與 provider 的生命週期綁定起來，當向 context 提供 state 的 container 卸載時，所有 state 都自動 reset，亦是減少耦合、提高復用。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;一個 provided pattern 例子&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// table.container.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Component &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Table&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Body&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Header&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TableContext &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../table.component&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TableContainer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    activeRow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      year&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1961&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      make&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Jaguar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      model&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;E-Type&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      year&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1969&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      make&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Farrari&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      model&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;365 GT 2 + 2&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    columns&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      editable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;year&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      editable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;make&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      editable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;model&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      editable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; columns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; activeRow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider
        value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          columns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          activeRow&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          selectRow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; activeRow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; id &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          updateRow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateRow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Table&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Header &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Body &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Table&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;activeRow &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; activeRow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Done&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;updateRow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rowId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findIndex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; rowId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// table.component.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createContext &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Input &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../shared/inputs&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; TableContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Row&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; row &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; columns &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
      columns&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;td key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;td&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;EditRow&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; row &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; columns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateRow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
      columns&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;td key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;editable &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input
              value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
              onChange&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;e &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateRow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            row&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;td&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Body&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; columns&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; activeRow&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; selectRow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tbody&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tr key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectRow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;activeRow &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;EditRow row&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Row row&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tr&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tbody&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; columns &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;thead&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tr&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;columns&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;th key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;th&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tr&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;thead&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;TableContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;table&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;table&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[你可能不需要 Derived State]]></title><description><![CDATA[componentWillReceiveProps、getDerivedStateFromProps 均是用於因應 props 變化以更新狀態，且不導致額外渲染的生命週期。但二者經常因誤用而引致 bug。本文旨在解釋其使用場景及反模式。]]></description><link>https://lumen.netlify.com/posts/derived-state/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/derived-state/</guid><pubDate>Fri, 27 Jul 2018 22:40:32 GMT</pubDate><content:encoded>&lt;h2&gt;何時使用 derived state&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 的意義僅在使組件依其 props 的變化來改變其內部 state。Derived state 不應頻繁使用，須遵循以下原則：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果你使用 derived state 以 memoize 一些祇基於當前 props 的計算，你就不需要 derived state。&lt;/li&gt;
&lt;li&gt;如果你無條件更新 derived state 或每當 props 和 state 不匹配時更新之，你的組件可能會過於頻繁地重置其 state。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;使用 derived state 的常見 bugs&lt;/h2&gt;
&lt;p&gt;對於組件有以下二類：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;controlled 組件&lt;/strong&gt;：數據以 props 傳入，父組件得以控制數據&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;uncontrolled 組件&lt;/strong&gt;：數據僅存於內部 state，父組件不能直接改變之&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Derived state 的最常見錯誤是混淆此兩者。若一 derived state 值也能被 &lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt; 所更新，該數據就不止有一個 source of truth。&lt;/p&gt;
&lt;h3&gt;反模式：無條件複製 props 至 state&lt;/h3&gt;
&lt;p&gt;一個常見誤解是 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;componentWillReceiveProps&lt;/code&gt; 祇在 props 變更時調用。事實是每當父組件重渲染時，這些 lifecycles 都會觸發，而不論 props 是否有變。因此，在這些 lifecycles 中無條件地覆蓋 state 並不安全，會造成 state 更新丟失。&lt;/p&gt;
&lt;p&gt;一個將 prop 映射至 state 的 &lt;code class=&quot;language-text&quot;&gt;EmailInput&lt;/code&gt; 組件：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EmailInput&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input onChange&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleChange&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function-variable function&quot;&gt;handleChange&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; event &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;componentWillReceiveProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 這會擦除任何本地狀態更新！&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 別這麼做。&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nextProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;每當其父組件重渲染時，往 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;input&amp;gt;&lt;/code&gt; 裏鍵入的內容就會丟失（&lt;a href=&quot;https://codesandbox.io/s/m3w9zn1z8x&quot;&gt;見例&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;加入 &lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt; 來讓組件祇在 &lt;code class=&quot;language-text&quot;&gt;email&lt;/code&gt; prop 變更時才重渲染，可以解決這個問題。但實際情況中，組件經常接收多個 props；另外的 prop 變更也會引致重渲染。&lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt; 應祇用於優化性能，而非用以糾正 derived state。&lt;/p&gt;
&lt;h3&gt;反模式：props 變更時抹除 state&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;componentWillReceiveProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 每當 `props.email` 變化時，即更新狀態。&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nextProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;現在組件祇會在 props 真正變更時，才抹除鍵入的內容。但在一些邊緣需求的用例下，會引致 bugs（&lt;a href=&quot;https://codesandbox.io/s/mz2lnkjkrx&quot;&gt;見例&lt;/a&gt;）。&lt;/p&gt;
&lt;h2&gt;Preferred solutions&lt;/h2&gt;
&lt;h3&gt;建議：fully controlled 組件&lt;/h3&gt;
&lt;p&gt;從組件完全移除 state——若 email 地址祇以 prop 形式存在，則不必擔心與 state 衝突。甚至可以把 &lt;code class=&quot;language-text&quot;&gt;EmailInput&lt;/code&gt; 轉換成一個輕量的函數組件：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;EmailInput&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input onChange&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onChange&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;建議：帶 key 的 fully uncontrolled 組件&lt;/h3&gt;
&lt;p&gt;讓組件完全擁有「draft」email 地址，但仍可接收一個 prop 作為初始值，唯忽略其後續變更。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EmailInput&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultEmail &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function-variable function&quot;&gt;handleChange&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; event &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input onChange&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleChange&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;（就上例的密碼管理器而言）為其加入一個 &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt; 屬性。當 &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt; 變化時，React 會新建一個組件實例，而非更新當前的組件實例。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;EmailInput
  defaultEmail&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;每當 ID 有變，&lt;code class=&quot;language-text&quot;&gt;EmailInput&lt;/code&gt; 會被重建且其 state 被重置（&lt;a href=&quot;https://codesandbox.io/s/6v1znlxyxn&quot;&gt;見例&lt;/a&gt;）。你祇須為整個 form 配置一個 &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;，每當 key 變化時，form 內的所有組件都會被重建並重置 state。&lt;/p&gt;
&lt;p&gt;在多數情況下，這是處理需要重置的 state 的最好方式。&lt;/p&gt;
&lt;p&gt;如果出於某些原因 &lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt; 沒有用（可能組件的初始化非常昂貴），一個可能但笨拙的方法是在 &lt;code class=&quot;language-text&quot;&gt;getDerivedStateFromProps&lt;/code&gt; 中監測 &lt;code class=&quot;language-text&quot;&gt;userID&lt;/code&gt; 的變動：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EmailInput&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultEmail&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    prevPropsUserID&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userID
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Any time the current user changes,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Reset any parts of state that are tied to that user.&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// In this simple example, that&apos;s just the email.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userID &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prevPropsUserID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultEmail&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        prevPropsUserID&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userID
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[朱熹中和說]]></title><description><![CDATA[朱熹的新舊中和說，主要在闡發《中庸》中關於已發、未發的思想，著重於討論「心」的層面。此文介紹中和說之餘，順便梳理其與孟子心性論、陽明心學之關係。]]></description><link>https://lumen.netlify.com/posts/zhuxi-theory/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/zhuxi-theory/</guid><pubDate>Sun, 01 Jul 2018 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;朱熹的新舊中和說，主要在闡發《中庸》中關於已發、未發的思想，著重於討論「心」的層面。&lt;/p&gt;
&lt;p&gt;近代學者都將朱熹的「心」解釋為「認知心」，而王陽明的「心」則具有道德主體之意。似乎朱熹沒有孟子心學的思路，而陽明才是真正繼承或完成孟子心性論主體思想體系。&lt;/p&gt;
&lt;p&gt;亦有學者認為朱熹談《中庸》之已發未發學說是出於心性論的角度，其對道德本心、良心的肯定並非不明確。&lt;/p&gt;
&lt;p&gt;朱熹如何談已發、未發來討論「心」之概念？朱熹論「心」是否僅取「認知心」之意義、抑或涵攝「道德本心」、「良心」的層面？&lt;/p&gt;
&lt;h2&gt;中和說之意涵&lt;/h2&gt;
&lt;p&gt;朱熹以四書及四書義理之學取代六經及六經訓詁之學作為整體經學的主體和基礎，強調四書重於六經，以四書闡明道統，為建構和完善道統思想體系作論證。&lt;/p&gt;
&lt;p&gt;如何閱讀四書，朱熹提出一「入道之序」：「&lt;em&gt;學問需以《大學》為先，次《論語》，次《孟子》，次《中庸》。《中庸》工夫密，規模大。&lt;/em&gt;」朱熹早年從學時即著重討論《中庸》義理，並對於已發未發的問題尤其注重，後來進而提出中和說。&lt;/p&gt;
&lt;h3&gt;中和舊說&lt;/h3&gt;
&lt;p&gt;朱熹反覆思索何謂「已發」「未發」的過程中，首先體認到：&lt;strong&gt;人生在世，無時無刻不與生活世界發生關係，而人在面對整體存在界的周流萬變，皆是時時發動念頭，包含人心在內皆屬於「已發」狀態。&lt;/strong&gt;故何來「未發」之際？當我們思考何為「未發」時，已全然在「已發」之中，如何有「喜怒哀樂之未發」時工夫操持的可能？&lt;/p&gt;
&lt;p&gt;既然人自出生始所有活動皆是已發，朱熹思考到是否未發是既有別於人心又與人息息相關的。朱熹進而認為整體存在界的流行變化，即使人未接觸應對客體時，仍然生機盎然地存在並作用者，其即為「天命流行、生生不已之機」，亦即「天理本真」是無時無刻不在作用當中。此「天理本真」是在人活動之前即有，是整體存在界運行的理序與規律，故言未發，它可存在於人的感知之外，卻又時刻可被人所感知到。而人之良心在接事應物時即會發生作用，體認到是否合乎天理或是僅為私慾。因此必須時時體察自我之良心發現即可「&lt;em&gt;貫乎大本達道之全體而復其初&lt;/em&gt;」。&lt;strong&gt;從已發中可見人之行為處事是否合乎未發的「天理本真」並時時察識並存養之，此即平時工夫操持。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此為「中和舊說」之主要論點，即以「天理本真」為未發，即「天命流行、生生不已之機」。所謂已發則是人心感物應事之發用。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「據其已發者而指其未發者，則已發者人心，而凡未發者接其性也，亦無一物不備矣。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——朱熹《答張敬夫》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;於是未發之天理本體是性，感物而動，進而有喜怒哀樂等情緒體顯是心的發用，因此&lt;strong&gt;性與心是體用關係&lt;/strong&gt;。此時「人心」是一思慮營為之心。但若心僅是一認知及感受之心，則如何使得人的行為「發而皆中節」、符合天理本真？&lt;/p&gt;
&lt;p&gt;於是朱熹認為心亦具備主宰功能。當事物呈現之時，心亦同時發動覺察，而「良心」亦萌發。此良心之萌發是接天理本真之性，而工夫之發用處即是致察良心的萌發並時時涵養操存之。&lt;/p&gt;
&lt;p&gt;但若心具有主宰功能，則何以有惡？朱熹認為人的行為會有合宜不合宜之分，在於心有沒有作為主宰，心若能作主宰則行為舉止皆合乎天理、則合情合宜；否則流於私慾和情緒，行為舉止乃有所偏頗。&lt;/p&gt;
&lt;h3&gt;中和新說&lt;/h3&gt;
&lt;p&gt;朱熹推翻舊說所言指心皆是已發，而認為「&lt;em&gt;思慮未萌，事物未至&lt;/em&gt;」「&lt;em&gt;喜怒哀樂之未發&lt;/em&gt;」之時即是心體寂然不動之時。而「&lt;em&gt;喜怒哀樂之情發&lt;/em&gt;」之際則是心體的發用。因此所謂已發未發是指心的動靜狀態，即心的兩層面。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「方其靜也，事物未至，思慮未萌，而一性渾然，道義全具，其所謂中，乃心之所以為體，而寂然不動者也。及其動也，事物交至，思慮萌焉，則七情迭用，各有攸主，其所謂和，乃心之所以為用，感而遂通者也。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——朱熹《答張敬夫》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;朱熹已心之用為已發，在中和新舊說中立場一致。至於未發之心，朱熹言「性為未發」亦是心之未發，如黃宗羲言「&lt;em&gt;合性於心，言工夫也&lt;/em&gt;」即是「持敬」工夫。朱熹言「心為已發、性為未發」則「日用工夫全無本領」，而又言「&lt;em&gt;向來議論思索，直以心為已發，而日用工夫，以止以察識端倪為最初下手處，已故闕卻平日涵養一段工夫&lt;/em&gt;」。其所謂平日涵養之工夫在於涵養「&lt;em&gt;事物未至，思慮未萌，而一性渾然，道義全具，其所謂中，乃心之所以體，而寂然不動者也&lt;/em&gt;」。&lt;strong&gt;心之未發之際，性亦未發；未發之心乃一實體，內含著道義俱全之性。心在已發之際，如何能體察本心中道義俱全的性，則不僅是思慮萌發之時省察行為、情緒，亦必須在未發之際存養本心之理。&lt;/strong&gt;此所謂「一性渾然，道義全具」之心體該是朱熹所指稱之「道心」；思慮營為之心，該是朱熹所稱之人心。唯道心與人心並非兩物，而是繫於人之心體但有已發未發之不同層面。&lt;/p&gt;
&lt;p&gt;心貫於已發未發，統合性情。當心未發，即思慮未萌，事物未至之時，性內在於心中，是心之虛靈，是性命之正。當事物交至，思慮萌發之時，性發動為情，心可以使發動之情有節制，此為道心；若心不使其發動之情有節制凡而使情傾向於私欲，則以人心稱之。於未發之際存養道義俱全之體，於已發之後時時省察行為處事，此「持敬」工夫，所著重是在「未發」時，存養工夫。&lt;/p&gt;
&lt;h2&gt;當代之詮解&lt;/h2&gt;
&lt;p&gt;當代學者的一大問題是：朱熹的心性思想是否承繼了孟子的道德心性學？在以心學與理學作為分判宋明理學的哲人時，&lt;a href=&quot;https://zh.wikipedia.org/zh-hant/%E7%A8%8B%E9%A2%90&quot;&gt;伊川&lt;/a&gt;、朱熹被列入理學體系，而與 &lt;a href=&quot;https://zh.wikipedia.org/zh-tw/%E9%99%B8%E4%B9%9D%E6%B7%B5&quot;&gt;象山&lt;/a&gt;、陽明的心學相異。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;象山、陽明：「心即理」，言心即是本心，而本心是道德的源泉與主體；「理」則明指仁義禮智等道德準則。人是一道德主體，因為此本心內含於人之中，且可以自律地體現出仁義禮智，此等理則非社會習俗亦非聖人特有而制訂的律則。&lt;/li&gt;
&lt;li&gt;伊川、朱熹：「性即理」，「心」僅為一「認知心」，既然是經驗認知的知覺心便僅能認識道理而無創生意義，仁義禮智是來於社會規範或聖人之教、而非人自發自覺的體認。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/zh-hant/%E7%89%9F%E5%AE%97%E4%B8%89&quot;&gt;牟宗三&lt;/a&gt; 認為象山、陽明是全然的孟子之學，其心性論是一「自律道德系統」，而伊川、朱熹的心性論則是一「他律道德系統」，與孟子心性體統不同。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/zh-hant/%E5%8B%9E%E6%80%9D%E5%85%89&quot;&gt;勞思光&lt;/a&gt; 認為朱熹的「心」是一「經驗主體」，只是能「知覺」「理」的能力，「理」才是一超驗實體。而孔孟至象山則是將「心」視為一超驗主體，是萬理之本。言朱熹是「立客體實有」而孔孟象山「立主體實有」。&lt;/p&gt;
&lt;p&gt;牟宗三認為中和舊說的性與心是體用關係，是承繼孟子心學的。朱熹所謂「&lt;em&gt;天命流行，生生不已之機&lt;/em&gt;」說明萬物之所以「生生不已」其「機」在於「天命流行」乃一創造實體，而「中」便是體認到「天命流行之體」。又及「寂然之本體」，牟先生認為「天命流行之體」是「&lt;em&gt;形式地說、客觀地說&lt;/em&gt;」而「寂然之本體」是「&lt;em&gt;內容地說、亦是主觀地說&lt;/em&gt;」。如此則「於穆不已」的「天命流行之體」不只是理，亦是心，亦可曰「寂感真機」。&lt;/p&gt;
&lt;p&gt;在舊說中，性與心是一體用關係，但在新說中，心與性被視為一平行的兩體。而之所以會有這樣的轉向，是由於朱熹從「天命流行之體」說「未發之中」，轉而從「心之寂然」說「未發之中」。前者視「中」為一「於穆不已」之創生實體，是為「中體」，後者則是指「中」為一描述語，描述心在未發之際的狀態。在新說中強調了「心體流行」即是心的活動作用。當心體未活動作用時，是思慮未萌、事物未至之時，言此時心處於「寂然不動」狀態，以此言「未發之中」，而此「未發之中」的寂然不動的心體體現了天命之理，也因此言心性平行關係。&lt;/p&gt;
&lt;p&gt;牟先生認為，朱熹在新說中，將心性視為一平行關係，真正的超越之實體（大本）只能是性，而不能是心。「心」必是一實然之心，其主要作用則是經驗知覺能力，但此一認知能力，使得人是為一經驗主體而非道德主體，「心」可以合於理，亦可以不合於理，全待於後天的修養工夫。&lt;/p&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[儒家脈絡]]></title><description><![CDATA[以歷史為脈絡，梳理儒家之源頭與歷程，乃知儒家與其他哲學宗教之相同之處，蓋在天人合一也。]]></description><link>https://lumen.netlify.com/posts/digest-of-confucianism/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/digest-of-confucianism/</guid><pubDate>Tue, 19 Jun 2018 22:40:32 GMT</pubDate><content:encoded>&lt;h2&gt;巫傳統&lt;/h2&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「儒之名蓋出於需。需者，雲上於天。而儒亦知天文識旱潦。何以明之？……古之儒知天文占候，謂其多技，故號遍施於九能，諸有術者悉亥之矣。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——章太炎《原儒》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;李澤厚說：中國的儒學系統的起源與發展，與天是分不開的，這可能是由於巫文化的傳統。中國上古之巫文化與西方薩滿均具有「絕地天通」之相似功用，扮演著古人在天人關係中溝通的媒介。禮在商代一開始跟巫文化是密不可分的，子曰：「&lt;em&gt;周因於殷禮。&lt;/em&gt;」&lt;/p&gt;
&lt;p&gt;周代繼承了殷商的文化遺產，並將禮樂重新制度化、政治化，逐漸形成新的完備體系，但其中繼承的巫文化一直在禮樂中佔有重要脈絡。商周之禮最初由模仿天道而來，是對宇宙和天命的模仿和敬畏；但到孔子那裏進行了突破性的翻轉和內化。勞思光說孔子將「&lt;strong&gt;禮攝於義，義攝於仁&lt;/strong&gt;」，由外在的宇宙論、人格天命觀轉為超越性的道與內在性的仁，至此中國文化發展出內在價值具有了個人超越性的可能。&lt;/p&gt;
&lt;h2&gt;孔子及其後學&lt;/h2&gt;
&lt;h3&gt;孔子&lt;/h3&gt;
&lt;p&gt;孔子「禮攝於義，義攝於仁」之過程，是將外在的天道轉變為內心的主動性，道德價值的實現不再外求於天，開始轉為內在的自覺境界。仁是一個古老的概念，非始於孔子。&lt;/p&gt;
&lt;p&gt;《國語・周語下》說：「&lt;em&gt;仁，文之愛也、愛人能仁。&lt;/em&gt;」說明早在西周，仁就具有慈愛之含義。但孔子將仁提升至一個道德層次的普世意義。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「仁即是視人如己、淨除私累之境界，此一境界是一自覺之境界，不假外求，不受約制，故孔子又即此以言自我之主宰性。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——勞思光&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「子曰：仁，遠乎哉？我欲仁，斯仁至矣。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《論語・述而》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;孔子奠定了仁內在於心的發端，這明顯不同於周公制禮作樂，後者的社會體系主要依賴於宇宙論與血緣建構，導致人與人之間的倫理關係並無很好的連結，但這點在孔子的仁學體系完成了轉變。&lt;/p&gt;
&lt;p&gt;《論語》一書以學的重要性來說明人的主動性將可以學以成仁。《中庸》一書則致力於結合傳統的周禮與新創的仁學體系。&lt;/p&gt;
&lt;h3&gt;孟子&lt;/h3&gt;
&lt;p&gt;孟子提出「四端」說。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「今人乍見孺子將入於井，皆有怵惕惻隱之心。……人之有是四端也，猶其有四體也。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《孟子・公孫丑上》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;每個人都有「四善端」，分別是「惻隱」「羞惡」「辭讓」「是非」。所謂性善並非人性本善，而是人皆有善端，發與未發全看個人的養氣和行動。善端使得人具有內在價值自覺之可能，以及逐漸完善自身之可能。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「萬物皆備於我矣。反身而誠，樂莫大焉。強恕而行，求仁莫近焉。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《孟子・盡心上》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;人如何通曉道德知識？透過誠意進而能知；正因為本心為善，故才能正其心，進而明德，培養出道德意義的「好惡之知」。&lt;/p&gt;
&lt;h3&gt;荀子&lt;/h3&gt;
&lt;p&gt;荀子不認同孟子心性論，謂以為孟子性善論是一自然事實，亦即「人性本善」。唯孟子本來之含意為人之心具有價值自覺之能力與實踐能力，非一出生即善的自然之心，故孟子言養氣成德，成德與否全在個人，人具有自由意志或實現能力來決定是否擁有德性。然荀子的心並不具備一主體，是「&lt;strong&gt;虛壹而靜&lt;/strong&gt;」之心（「&lt;em&gt;心何以知？曰：『虛壹而靜』&lt;/em&gt;」《荀子・解蔽》），虛靜之心僅有觀照功能，而無主動性，故荀子實否定一內在主動（體）性之可能。除了跟孟子心性論的差異外，荀子哲學另一特色就是重談禮，並透過義的結合，讓禮能夠與理接軌，成為一個新體系。同時荀子重視聖人的作用，認為聖人扮演著溝通天地並制禮作樂的角色。&lt;/p&gt;
&lt;h2&gt;漢代的天人之際&lt;/h2&gt;
&lt;p&gt;秦朝焚書之後，宇宙論和巫文化再次活躍於中國文化中，此即結合巫蠱、宇宙論、天命觀而形成的西漢儒學，價值根源又回到天。此時的天是一具有人格性、意志性的天。&lt;/p&gt;
&lt;p&gt;在漢代的儒家思想脈絡中，「性」是最重要的部分之一，這其實是對孟、荀思想的繼承發展。此時的儒學，除了經學之外，還展開了對「性」「情」之辯。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;董仲舒將性完全歸於天和命。&lt;/strong&gt;「&lt;em&gt;命者天之令也，性者生之質也，情者人之慾也。或夭或壽，或仁或鄙，陶冶而成之，不能粹美，有治亂之所生，故不齊也。&lt;/em&gt;」上天造人之時，就已經各有不同的質和屬性，也帶有可能遮蔽人理智的「情」，故需要聖王聖人來教化。「&lt;em&gt;為政而宜於民者，固當受祿於天。夫仁誼禮知信五常之道，王者所當修飭也；五者修飭，故受天之佑，而享鬼神之靈，德施於方外，延及群生也。&lt;/em&gt;」上天會藉由天人感應來賞罰君主和百姓的作為。「&lt;em&gt;天者，百神之君也，王者之所最尊也。&lt;/em&gt;」董仲舒認為，&lt;strong&gt;天創造了人和萬物，主宰著一切。統治者宜順應天意、順百姓之性來治理國家。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;漢代宇宙論和天命主宰觀直至東漢王充《論衡》一書中方有劇烈轉變。&lt;strong&gt;王充在〈物勢〉中提及勢非由陰影五行所訂，亦即非由天命所定，乃是萬物自身之因素&lt;/strong&gt;，此即〈物勢〉通篇主旨。王充可謂是開啓了魏晉思潮之先。&lt;/p&gt;
&lt;h2&gt;魏晉沈香至唐韻風骨&lt;/h2&gt;
&lt;p&gt;曹魏經學家王弼，將無上升至道的層面，融合儒道，別開新面。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「凡有皆始於無，故「未形」、「無名」之時則為萬物之始，及其「有形」、「有名」之時，則長之育之，亭之毒之，為其母也。言道以無形無名始成萬物，以始以成而不知其所以玄之又玄也。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——王弼《道德經註》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;至西晉郭象則由老子入莊子，談「獨化」「自生」：「&lt;em&gt;請問夫造物者有耶，無耶？無也，則胡能造物哉？有也，則不足以物眾形。故明眾形之自物，而後始可與言造物耳。是以涉有物之域，雖復罔兩，未有不獨化於玄冥者也。故造物者無主，而物各自造。物各自造而無所待焉，此天地之正也。&lt;/em&gt;」（郭象《莊子註》）&lt;strong&gt;萬物皆是自生自滅，自己的特性（才性）並不來自上天。萬物對於自己的生滅沒有自我主宰性，都是偶然的。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;同時萬物的屬性，包括人的仁義道德、優劣好壞等，也都是註定的、無法改變的，所以聖人和君主，要順著人的本性來施政，才是無為之境——而非因為要順著天的意志。&lt;/p&gt;
&lt;p&gt;可以留意到，雖然王弼、郭象他們都不盡然是儒家為核心的思想，然而都延續了漢代對於「性」的重視。&lt;/p&gt;
&lt;p&gt;除性之學外，東漢末年，佛教東傳，教派繁盛，中觀學、唯識宗、法性宗、天台宗、華嚴宗、禪宗等等，百家爭鳴，蔚為大觀。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「天台有所謂『心生萬法』；華嚴宗有融佛性於真心；禪宗則更認為佛性即人之本心（本性）。由於佛教的中國化，使得中國化的佛教宗派、特別是禪宗大大改變了印度佛教的原貌。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——湯一介《矚望新軸心時代：在新世紀的哲學思考》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;唐武宗「會昌毀佛」後佛學一時大衰，但是佛學的理論早就融於儒學之中。唐代韓愈雖然察覺孔孟之道的失傳，但其立說如《原道》依然沒有將心性與才性的差異辨析明白，與他所嚮往的孔孟之道亦有距離。可以說漢以降至唐代韓愈，孟子思想基本無所繼承發展。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「他日若能窺孟子，終身何敢望韓公。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——王安石&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;h2&gt;兩宋與古今之變&lt;/h2&gt;
&lt;p&gt;北宋始時，儒學再次受到重視。葛兆光說：「&lt;em&gt;因為士人相信，中唐以來國家權威的失墜，是由於社會道德的淪喪、倫理崩壞，人們對國家合法性與秩序合理性的漠視……長達兩個世紀的變動，曾經給士人留下相當的痛苦和相當深刻的印象，也刺激了重建國家與思想秩序的想法……正是在這種心境下，超越自然與社會的道，或為政治國家、道德倫理、宇宙構架、自然知識提供同一性依據的理，才會被提出來。&lt;/em&gt;」&lt;/p&gt;
&lt;p&gt;而此時的儒學也面臨佛教、道教的挑戰，佛教中國化的進程和道教精密化、規範化、制度化過程，給儒者以極大的震撼和衝擊，儒教文明必須改弦易張，必須吸收佛道之長，融突創新，使儒釋道三教合一。故北宋儒學不論是理學、蜀學、功利學派等等，基本都具有高度融合儒釋道三家與積極追求孔孟正統但同時又再詮釋的特徵。&lt;/p&gt;
&lt;h3&gt;二程&lt;/h3&gt;
&lt;p&gt;程顥（明道）的形上學，最值得注意的是&lt;strong&gt;生生&lt;/strong&gt;和&lt;strong&gt;一本&lt;/strong&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;生生—是明道藉由易經產發的形而上理論。明道謂：「&lt;em&gt;生生謂之易，是天之所以為道也。&lt;/em&gt;」；「&lt;em&gt;天地設立，而易行乎其中。&lt;/em&gt;」將易的道理作為一種「於穆不已」的流動「易體」，而這種易體其實也就是所謂的一本。&lt;/li&gt;
&lt;li&gt;一本—牟宗三謂：「&lt;em&gt;所謂『一本』者，無論從主觀面來說，或從客觀面來說，總只是這『本體宇宙論的實體』之道德創造或宇宙生化之立體地直貫……它是本體宇宙論實體，司時亦即是德創造（道德行為之純亦不已）之創造實體（creative reality）。&lt;/em&gt;」牟宗三之意，即「一本」者既是天地化生之本源，同時也是道德的創造者。一本論之下，沒有「我」與「他者」，萬物都是一，雖從本源中生化而出，但並沒有脫離本源，而是始終一體。明道「&lt;em&gt;以仁者與天地萬物為一體&lt;/em&gt;」是為仁者能與物同體，也就是說，創生的本源在創生時，就同時賦予被創生者道德意義。這樣一來就確保了世界的道德來源，明道以其一本從而得以貫通天理性命。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;與之相比，程頤（伊川）之形上學是否具有此種動態，就成為二程的主要分歧。對於伊川來說，仁是性（理），而愛是情（氣）。理氣二者的關係不即不離，理恆常而氣變化，二者在現實上雖不可分，在概念上卻必須加以分疏。明道雖也劃分形上、形下，但道即器、器即道，二者乃一體之兩面。伊川卻將理氣分屬兩層，理論效果乃大不同。伊川說：&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「『一陰一陽之謂道』，道非陰陽也，所以一陰一陽，道也。如一闔一闢為之變。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《二程遺書》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;明道那裏，道就是陰陽，但伊川將其區隔。不過伊川又補充說：&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「離了陰陽更無道，所以陰陽者是道也，陰陽氣也。氣是形而下者，道是形而上者。形而上者則是密也。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《二程遺書》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;言陰陽是氣，所以陰陽者是道，一為形而下，一為形而上，陰陽之能運行，是由於道所致。程伊川在此面臨一個哲學困難，牟宗三認為這是其必須花大力氣去闡釋「氣論」的原因，此困難就在於，伊川將「生成源」與「生成」二事區分開來，生成者「道」和負責生成的「陰陽」被區隔，道只存有而不活動。而為了說明道的「化生」，伊川必須以氣論入手，而這點又直接影響了性論。原本在明道那裏，性直接貫通天道，但在伊川這裏，性是透過氣而化生，從而其心就分成「已發」「未發」的存有狀態。這點可謂是大小程的一個根本不同。&lt;/p&gt;
&lt;p&gt;牟宗三謂程伊川是「旁出」，並未承接「孟子—程明道」的系統，理由是伊川之理無法化生進而產生自律道德。但此番質疑是否成立，還需要考察伊川是否偏離了「一本」思想。伊川之化生理論繁雜而不流動，並不能說明伊川就不是一本。伊川云：&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「理也，性也，命也，三者未嘗有異。窮理則盡性，盡性則知天命。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《二程遺書》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;此能看出伊川歸根結底也是一本論。牟宗三認為伊川之理不流動，恰有可能是因為伊川要解決明道之工夫論離生活實踐頗有抽象距離的問題。伊川又云：&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「道一也。未有盡人而不盡天者也。以天人為二，非道也。子雲謂：『通天地而不通人，曰伎。』亦猶是也。或曰：『乾，天道也；坤，地道也。』論其體則天尊地卑，其道則無二也。豈有通天地而不通人？」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——《二程遺書》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;伊川只是把人生至高的境界轉換為某種日常的切己工夫。可以說明道完成的是抽象的理論，而伊川則加以具體化建構。這也可以理解，為何伊川也認為，工夫論不出一個「敬」字，此正「涵養須用敬，進學則在致知」。透過「敬」的內在修為進而能格物致知，進而能窮知天理，這與程明道內心直達天理其實殊途同歸，只是更為具體化。&lt;/p&gt;
&lt;h3&gt;朱子&lt;/h3&gt;
&lt;p&gt;朱熹在張載和二程的基礎上，進一步展開自己的思想。「&lt;em&gt;蓋太極是理，形而上者，陰陽是氣，形而下者。然理無形，而氣卻有跡。&lt;/em&gt;」朱熹認為萬物背後有一超越之道，氣是道的表現，同時也是萬物本質，理氣不能分離，亦無先後。「&lt;em&gt;或問『理在先，氣在後』。曰：『理與氣本無先後之可言。但推上去時，卻如理在先，氣在後相似。』&lt;/em&gt;」理氣不可分離，理在氣的先，是指邏輯上的先，不是時間上的先。萬物背後有一個普遍之理，但因為事物不同，普遍之理的表現方式亦有不同。&lt;strong&gt;這裏的普遍之理非指萬物的同一（和莊子不同），而是指在更高的層次來看，它們具有普遍原則的同一性。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;朱熹云「&lt;em&gt;天地中有一太極，萬物中各有一太極&lt;/em&gt;」；「&lt;em&gt;人人有一太極，物物有一太極&lt;/em&gt;」。太極指萬物的共同本體，事物的性理來自太極，卻非分有太極的狀態，而是物物各自的太極（此處是儒家哲學的一難題）。以月為例，月印萬川，隨處均可見，萬川之月只是天上之月。&lt;/p&gt;
&lt;p&gt;朱子早年認為心分成未發和已發兩種狀態（簡單而言，未發指心情平靜、情緒平穩的一種精神體驗，同時也是哲學上心之體的一種沈靜不動，亦即「中」。已發指有情緒活動，同時也是哲學上心的活動。），但後來轉向一種更具寬闊意義的認識。根據未發和已發的不同狀態，有不同的工夫涵養。在未發狀態時的涵養工夫是「主靜涵養」，具體要收斂、謹畏、惺惺、主一、整齊嚴肅。已發時的工夫論是「格物致知」，格，至也，物，猶事也，窮盡事物之理。而從涵養守敬到格物窮理的背後目的，並不只是一種哲學上的認識論或是神秘的精神體驗，如郭齊勇指出：「&lt;em&gt;此具統一性、普遍性的本體之理為人所本具有亦即人自身所本有的仁義之性，故他所謂物理也就無非是儒家道德倫理準則和行為規範，而格物格得無非就是與倫理有關的事物，而窮理即窮與倫理有關的理。&lt;/em&gt;」&lt;strong&gt;朱熹希望的是透過一理論，一方面制約君權，保護百姓利益，一方面是使國家富強，並為孔子以降的道統與道學找到一基礎。&lt;/strong&gt;朱熹曾說：「&lt;em&gt;鄭氏曰：『言作禮樂者，必聖人在天子之位。』&lt;/em&gt;」他認為三代到周都有道統，周以降只有霸業沒有道統（外王無內聖）。孔子雖為聖人但不在天子之位，故有道學，而道統不會因為時間而消逝或改變。朱熹希望將孔子的道學發揚，上升到國家與文化高度，再次與道統接軌。如余英時在其經典作品《朱熹的歷史世界》中所敘述的：「&lt;em&gt;道學與哲學間不能畫上等號，這是不證自明的……治統的合法性來自於道統。&lt;/em&gt;」朱熹認為「&lt;em&gt;千五百年之間，堯舜三王周公孔子所傳之道，未嘗一日得行於天地之間也。&lt;/em&gt;」而朱熹如此在意道統的原因或許如馮友蘭所揭示的「&lt;em&gt;所以王霸之分，推其本源也就是義利之辯&lt;/em&gt;」，朱熹在意的正是道德正當性和「被統治者的幸福」。&lt;/p&gt;
&lt;h3&gt;陸九淵與王陽明&lt;/h3&gt;
&lt;p&gt;陸九淵大體與朱熹同時。「&lt;em&gt;存之者，存此心也，故曰：『大人者不失其赤子之心。』四端者，即此心……人皆有是心，心皆具是理，心即理也。&lt;/em&gt;」陸九淵認為價值歸於內在，毋須外求，反對朱熹格物致知與理學心有外理的主張。陸象山之心，乃指此自覺能力，即能立價值標準，能為一切價值詞語意義根源者。&lt;strong&gt;象山強調心之普遍性，恰與朱氏強調心的特殊性相對。&lt;/strong&gt;至此，陸象山回歸孟子心學之方向，為後來的王陽明打下基礎。&lt;/p&gt;
&lt;p&gt;王陽明的核心乃致良知，為何要致良知、如何致良知是一個根本的儒學問題。美國漢學家倪德衛（David S. Nivison）在 &lt;em&gt;Motivation and Moral Actionin Mencius&lt;/em&gt; 一文中指出，&lt;strong&gt;早期中國哲學的特色是不質疑道德動機之來源，但思考了道德動機到道德實踐之間的難題&lt;/strong&gt;。到了王陽明那裏，其關鍵就在於工夫論，而核心就是以「誠意」修心進而完成「知行合一」。道德實踐的關鍵特色和重點，便在於「知」與「行」並非是兩件事，而是一件事。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「今人卻就將知行分作兩件去做。以為必先知了，然後能行。我如今且去講習討論做知的工夫。待知得真了，方去做行的工夫。故遂終身不行，亦遂終身不知。」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——王陽明《傳習錄》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;《孟子・盡心上》：「&lt;em&gt;人之所不學而能者，其良能也；所不慮而知者，其良知也。&lt;/em&gt;」焦循（清代《孟子》《易經》經學家）在闡釋時把「良知」和「良能」解釋成兩種事物，認為中間還需要聖人的教化來完成。然而焦循的解釋並未貼近孟子原意。&lt;/p&gt;
&lt;p&gt;《孟子・梁惠王上》：「&lt;em&gt;故王之不王，非挾泰山以北海之類也；王不之王，是折枝之類也。老吾老，以及人之老；幼吾幼，以及人之幼；天下可運於掌。&lt;/em&gt;」王之道統並非不可能之事，而是不願意之事，在此孟子進一步凸顯「能」與道德的自然聯繫。&lt;/p&gt;
&lt;p&gt;《孟子・盡心上》：「&lt;em&gt;萬物皆備於我矣。反身而誠，樂莫大焉。強恕而行，求仁莫近焉。&lt;/em&gt;」如勞思光所云：「&lt;em&gt;孟子此處之所謂「知」，蓋指自覺而言；心之發用即是性之顯現，……心發用至充足狀態，方自覺到自身之性……故亦即自覺其為萬里之源。&lt;/em&gt;」&lt;/p&gt;
&lt;p&gt;王陽明對知的此點準確地把握住孟子的原意：「&lt;em&gt;知是行之始，行是知之成。若會得時，只說一個知，已自有行在。只說一個行，已自有知在。&lt;/em&gt;」&lt;strong&gt;知行的合一在此已表述無遺。良知必須知行合一，不僅有內在的認識，同時有外在的行動，所謂「&lt;em&gt;實實落落依良知去做&lt;/em&gt;」，至此方是一個完整的「致良知」&lt;/strong&gt;。也就是說，王陽明認為，不存在理學中所謂知與行孰先孰後的問題，&lt;strong&gt;道德主體性不能脫離形而上的基礎，也不能脫離形而下的具體行為。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如同漢學家 Joseph A. Adler 所言：「&lt;em&gt;一個在儒學中的核心問題是，如果人性本是善的，那為何會有惡？惡是從哪裡來的？為何人人都不是聖人？&lt;/em&gt;」王陽明亦不可避免必須解釋，若知行合一便可免除惡，那何以大部分人還沒法達到完全的道德實踐生活呢？對此王陽明的回應是：&lt;/p&gt;
&lt;p&gt;「&lt;em&gt;在虔與於中、謙之同侍。先生曰：『人胸中各有個聖人，只自信不及，都自埋倒了。』因顧於中曰：『爾胸中原是聖人。』於中起不敢當。先生曰：『此是爾自家有的，如何要推？……眾人皆有之，況在於中，卻何故謙起來？謙亦不得。……良知在人，隨你如何不能泯滅，雖盜賊亦自知不當為盜，喚他做賊，他還忸怩。』於中曰：『只是物慾遮蔽，良心在內，自不會失；如雲蔽日，日何嘗失了！』先生曰：『於中如此聰明，他人見不及此。』&lt;/em&gt;」&lt;/p&gt;
&lt;p&gt;良知是先驗的，同時又是實踐的。「胸中原是聖人」不代表真的可以成為聖人，「&lt;em&gt;作為致知對象的良知並不是靜態的本體，它本質上處於發用流行的過程中。&lt;/em&gt;」（楊國榮《王學通論：從王陽明到熊十力》）只有透過知行合一，才能真正實踐良知，才是真知。大部分人尚沒法結合起來，「無自制力」。&lt;strong&gt;而克服這種無自制力的最好方法就是時刻地發源本心，以本心去致良知，方能知行合一。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;對王陽明而言，惡是整全性的缺失，而這點可以用工夫論去克服。王陽明講「四句教」：「&lt;em&gt;無善無惡心之體，有善有惡意之動，知善知惡是良知，為善去惡是格物。&lt;/em&gt;」&lt;strong&gt;正因為大多數人是「有習心在」，心體隨人在世而顯於外，由於受到外物矇蔽，意念發動時便落在有善有惡上。&lt;/strong&gt;（習心，理學家指透過耳聞目見所得的意念，與良知良能有別。《二程遺書》：「&lt;em&gt;蓋良知良能，元不喪失，以昔日習心未除，卻須存習此心，久則可奪舊習。&lt;/em&gt;」）&lt;/p&gt;
&lt;p&gt;人人皆可道德修養，達致道德上的內聖，此是王陽明傳承與發揚孟子的重要特徵。&lt;/p&gt;
&lt;figure&gt;
	&lt;blockquote&gt;
		&lt;p&gt;「有明學術，從前習熟先儒之成說，未嘗反身理會，推見至隱，所謂『此亦一述朱，彼亦一述朱……故無姚江，則古來之學脈絕矣。』」&lt;/p&gt;
		&lt;footer&gt;
			&lt;cite&gt;——黃宗羲《姚江學案》&lt;/cite&gt;
		&lt;/footer&gt;
	&lt;/blockquote&gt;
&lt;/figure&gt;
&lt;p&gt;明代王學出現以前，是朱學的天下。王學對於朱學的態度，不再滿足於「述朱」。儘管宋代有改經風氣，而明代王學對於經學尤其是《大學》，則是採取復古的態度。因此，明代學術不支持宋代改經，而是回到漢學。然而明代經學不同於漢代，意不在表面的字句或順序，而在於印證於心——即王陽明所稱作「行」。&lt;/p&gt;
&lt;p&gt;余英時指出，天和人分別代表「超越領域」和「現實領域」，故天人關係、天人合一其實並不只是一種對天的敬畏或是某種特殊的精神體悟，還代表了一種逐漸完善自身的過程。這種觀點以劉殿爵所翻譯的英譯《孟子》序言可看出：「&lt;em&gt;如此一來，孟子已經打破天人隔閡及天命與人性之間的藩籬，由人心深處有一密道可通上天，而所屬天者已經非外於人，反而是屬於人最真實的本性了。&lt;/em&gt;」龐樸又言：「&lt;em&gt;儒學走向心性論研究，相信人道源於人心。&lt;/em&gt;」&lt;/p&gt;
&lt;p&gt;但我們也須思考，最終心學得出的德性近乎於完全歸結於內心的結論，其實是否已經是對於傳統儒家的偏離？天命觀與經學幾乎完全從心學的視野裏消失，其實也意味著人論基礎的破碎化和個人化，最終極有可能造成一種顛覆。而這種內在的衝突，其實早在孔子那裏便已埋下伏筆。&lt;/p&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[禪宗公案之疏山有句無句]]></title><description><![CDATA[唐末僧疏山問大安：「有與無的概念既如同藤繞樹，忽遇樹倒藤枯，世界又歸何處？」大安聽畢，呵呵大笑而歸。]]></description><link>https://lumen.netlify.com/posts/koan-sozan/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/koan-sozan/</guid><pubDate>Fri, 01 Jun 2018 22:40:32 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;唐末僧&lt;u&gt;疏山&lt;/u&gt;特至福州溈山參學&lt;u&gt;大安&lt;/u&gt;之「&lt;strong&gt;有句無句，如藤倚樹&lt;/strong&gt;」（有與無的概念如同藤繞樹），並請問「忽遇樹倒藤枯，句歸何處」，&lt;u&gt;大安&lt;/u&gt;聞後，放下泥槃，呵呵大笑而歸方丈；&lt;u&gt;疏山&lt;/u&gt;不滿，深感賣卻布單，特為此事遠道而來，和尚何得相弄；&lt;u&gt;大安&lt;/u&gt;遂囑侍者予師二百錢，並告知&lt;u&gt;明招德謙&lt;/u&gt;可為師點破。&lt;u&gt;疏山&lt;/u&gt;遂往明招處，&lt;u&gt;明招&lt;/u&gt;欲為其點破，謂「頭正尾正，祇是不遇知音」。師亦不明白，又問「忽遇樹倒藤枯，句歸何處」，明招以「卻使&lt;u&gt;溈山&lt;/u&gt;笑轉新」作答，師乃言下大悟，有感而謂「&lt;u&gt;溈山&lt;/u&gt;元來笑裡有刀」，遙望禮拜。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有與無的問題是抽象觀念和哲學問題。吾人一切思想皆始於有無之對立，若無這種對立，吾人就不可能推理。因此，疏山的問題直擊基本：「若有與無的概念枯萎掉，吾人的思想體系將會如何？」當樹倒下，藤亦自然枯死。有必須與無為伴，才成其存在，反之亦然。唯有當吾輩認識到有與無之基本對立，才能對個殊事物的世界有所瞭解。當此有無之對立不再存在時，吾輩將前往何處？絕對的空無嗎？這似乎是不可思議的。如此，則這種對立看法是否根本就錯了呢？然而它又面對著吾人，吾人無法消除這個生與死的世界；而這生與死的世界，以眼下的狀態而言，又遠不能滿足吾人精神上的需要。這種生與死、有與無的對立似非最終階段，而吾輩又永遠渴切超逾它；它指向某種愈高、愈深之事，而此事是吾輩希望抓住的。相互的對立狀態是必須超逾的，但如何超逾？事實上這正是疏山所提之問題。&lt;/p&gt;
&lt;p&gt;祇有吾人還停留在相互對立的世界，吾人就永不得滿足；吾人常被不安感所騷擾。疏山深受有與無或生與死的問題所騷擾——或就基督教之說法，深受靈魂不死的問題所騷擾。當他聽聞溈山大安和尚言及此事時，他想終於有人可助他解決這個問題、為他帶來安寧了。他變賣財物，長途跋涉來到溈山，迫不及待地向正在抹泥牆的大安祈求啟悟：「當這個世界在這一劫結束之際，同它的一切萬象俱化成灰之後，我們這些人、我們人類的靈魂都會如何呢？」&lt;/p&gt;
&lt;p&gt;此問題，既是形而上學的，又是宗教的。就以它不想沿著純粹智性的路線來發展而言，它是宗教的；就以它是以抽象的概念為表達方式而言，它又是形而上的。此乃禪宗之一大特色。若想選用一個名字，可稱之為實際哲學，而這種實際性全可從溈山大安用大笑來回答疏山的問題表明出來。&lt;strong&gt;疏山的心相當於形而上學，故會訴諸有與無這樣抽象的概念，但他的實際心靈又使他把這種抽象概念化為樹與藤之間的具體關係。&lt;/strong&gt;然而疏山的這種實際性卻被大安更進一步的實際性徹底攪亂了：大安丟下泥槃，大笑歸去。大安完全是實際行動的，而疏山則還在語言象徵的層面；這即是說，他還在概念層面，離開了生活。&lt;/p&gt;
&lt;p&gt;疏山仍舊是語文的困囚，他不能立即抓住真如。他的心充滿了有與無、樹與藤、生與死、絕對與限制、因與果、業與涅槃等觀念，而對事實的真如沒有直接的領悟。而大安根本不同這位邏輯家辯論，不談絕對又不談矛盾辯證，亦不談在有與無的對立之下的基本存在。他祇是大笑歸去。&lt;/p&gt;
&lt;p&gt;疏山的問題有何好笑？吾輩人類總是因自己所見事物之毀壞而憂愁，尤以關於吾人肉體的存在、以及之後的來生為然。這似乎是吾人共同的情感，何以惹來禪師的大笑呢？他大笑不特止，還丟下了器具、停止工作，回到自己的房中。他這樣做，是否意味著不要問任何東西，祇須去過生活、享受生活，當事物展現在吾人面前時，就按照它們的樣子認識它們，當可笑的事物出現就笑，當使你哭的事物出現就哭——總之，是否意味著接受一切，並因此歡愉呢？或者他意味當世界結束之際，他就享受同世界一起結束？或者他意味並無所謂結束——一切都是永恆，相對的世界祇是表象——因之並無樹倒亦無藤枯，由此來截斷由相對觀念與表象為基礎所產生的概念臆想？或者他大笑發問者的愚蠢，這個愚蠢使得他未能認識到他內在正運作著的另一樣東西，這種東西是與他對樹倒藤枯的深切關懷完全分開的；或者從另一角度說，是與他對樹倒藤枯的深切關懷交合並進的。所有這些意義上的變化，都可以在大安的行為中覽讀出來。但從禪的觀點來看，此處當務之急，是在直接體驗那意義之本身，而把智性的解釋留待必然隨這體驗產生的禪意識去做。&lt;/p&gt;
&lt;p&gt;在這整個故事裏，並無任何形而上學的討論，沒有任何神祕虔敬的宗教行為。它始於對有與無的哲學性詢問，將之比於藤繞樹；而其解答則完全沒有按照原路線——而是絕對超乎常人在這種情形下的預期。而更為特異的是發問者終竟了悟了禪師的怪異行為，後者蘊涵的意義顯然解除了有與無的對立糾纏。&lt;/p&gt;
&lt;p&gt;附：&lt;/p&gt;
&lt;p&gt;當圜悟問五祖關於樹倒藤枯的事情時，五祖說：「你設網自陷。」體驗有其表達方法，它需要說出來，它需要肯定它自己、意識到它自己。而為了這樣做，禪有其絕對獨特的方式。既然沒有任何方式可以把完美的禪體驗世界描繪出來，則有與無、樹與藤、生與死、綜合與對立、內在與超越、毀壞與構築、倒與枯以及化歸無物等又是甚麼呢？所有這些觀念與範疇，都是我們為了生活在這個世界而發明的方便工具；但除非我們知道，如何在得當的機會應用它們，它們就會轉過來把我們陷住；亦即是說，我們會被它們所奴役所束縛。當禪體驗未能被我們適當地掌握，它就變成一個導致不幸的工具。這個體驗是一把雙刃劍，需要小心謹慎。&lt;/p&gt;
&lt;p&gt;本文錄自鈴木大拙《禪學隨筆》並改寫&lt;/p&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[事件循環之 Macrotask & Microtask]]></title><description><![CDATA[JavaScript 的事件循環（Event Loop）中，macrotask 和 microtask 同屬於異步任務。二者有什麼區別？何時使用何者？]]></description><link>https://lumen.netlify.com/posts/macrotask-and-microtask/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/macrotask-and-microtask/</guid><pubDate>Fri, 01 Jun 2018 22:40:32 GMT</pubDate><content:encoded>&lt;h2&gt;定義&lt;/h2&gt;
&lt;p&gt;一個事件循環（event loop）中會有一個正在執行的任務（task），這個任務就是從 macrotask 中來的。當該 macrotask 執行結束後，所有可用的 microtask 將會在同一個事件循環中執行，當這些 microtask 執行結束後還能繼續添加 microtask 直至整個 microtask 隊列執行結束。&lt;/p&gt;
&lt;h2&gt;用法&lt;/h2&gt;
&lt;p&gt;當我們想以同步的方式處理異步任務時就用 microtask（比如需要直接在某斷代碼後去執行某個任務，正如 Promise）。其他情況就直接用 macrotask。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;macrotasks: &lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;setInterval&lt;/code&gt;、I/O、UI 渲染&lt;/li&gt;
&lt;li&gt;microtasks: Promise、&lt;code class=&quot;language-text&quot;&gt;process.nextTick&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Object.observe&lt;/code&gt;、MutationObserver&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;規範&lt;/h2&gt;
&lt;p&gt;根據 WHATWG 規範：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一個 event loop 會有一個或多個 task queue 即 macrotask queue&lt;/li&gt;
&lt;li&gt;每個 event loop 都有一個 microtask queue&lt;/li&gt;
&lt;li&gt;task queue == macrotask queue != microtask queue&lt;/li&gt;
&lt;li&gt;一個 task 可放入 macrotask queue 亦可放入 microtask queue&lt;/li&gt;
&lt;li&gt;當一個 task 被放入 queue（macro/micro）則該 task 可被立即執行&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;當 call stack 為空時，開始依次執行：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把最早的任務 task A 放入任務隊列&lt;/li&gt;
&lt;li&gt;若 task A 為 null（則任務隊列為空），直接跳到第 6 步&lt;/li&gt;
&lt;li&gt;將 currently running task 設為 task A&lt;/li&gt;
&lt;li&gt;執行 task A（即執行回調函式）&lt;/li&gt;
&lt;li&gt;將 currently running task 設為 null 並移出 task A&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;執行 microtask queue&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在 microtask 中選出最早的任務 task X&lt;/li&gt;
&lt;li&gt;若 task X 為 null，直接跳到 xii&lt;/li&gt;
&lt;li&gt;將 currently running task X 設為 task X&lt;/li&gt;
&lt;li&gt;執行 task X&lt;/li&gt;
&lt;li&gt;將 currently running task 設為 null 並移出 task X&lt;/li&gt;
&lt;li&gt;在 microtask 中選出最早的任務，跳到 ii&lt;/li&gt;
&lt;li&gt;結束 microtask queue&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;跳到第 1 步&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;上面是一個簡單的 event loop 執行模型。再簡單點可總結為：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在 macrotask queue 中執行最早的 task，然後移出&lt;/li&gt;
&lt;li&gt;執行 microtask 隊列中所有可用的任務，然後移出&lt;/li&gt;
&lt;li&gt;下一個循環，執行下一個 macrotask 中的任務（跳到第 2 步）&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;其他&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;當一個 macrotask 正處執行狀態，亦可能會有新的事件被註冊（創建新 task）。比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;promiseA.then()&lt;/code&gt; 的回調就是一個 task&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;promiseA&lt;/code&gt; 是 resolved 或 rejected，則該 task 會放入當前事件循環回合的 microtask queue&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;promiseA&lt;/code&gt; 是 pending，則該 task 會放入事件循環的未來某個回合的 microtask queue&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt; 的回調也是 task，它會被放入 macrotask queue（即使是 0ms）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;microtask queue 中的 task 會在事件循環的當前回合中執行，因此 macrotask queue 中的 task 就只能等到事件循環的下一個回合執行&lt;/li&gt;
&lt;li&gt;click、Ajax、&lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt; 的回調都是 task，包裹在一個 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;script&amp;gt;&lt;/code&gt; 標籤中的 JS 代碼亦是一個 task——它們都是 macrotask。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[入禪五位]]></title><description><![CDATA[曹洞宗創始人洞山良價禪師［唐］提出入禪五位，即開悟過程之五階段。鈴木大拙博士對此作了深刻而詳盡的解析。]]></description><link>https://lumen.netlify.com/posts/five-steps-into-zen/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/five-steps-into-zen/</guid><pubDate>Thu, 24 May 2018 22:40:32 GMT</pubDate><content:encoded>&lt;p&gt;「位」者意為「境地」、「階段」或「步驟」。&lt;/p&gt;
&lt;p&gt;入禪五位如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;正中偏&lt;/strong&gt;——「在正中的偏」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;偏中正&lt;/strong&gt;——「在偏中的正」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;正中來&lt;/strong&gt;——「从正中出來」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;兼中至&lt;/strong&gt;——「到達兼」&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;兼中到&lt;/strong&gt;——「安于兼」&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;此五位分成兩組：睿知的（noetic〔&lt;fs&gt;心智的&lt;/fs&gt;〕），和情意的（affective〔&lt;fs&gt;感情的&lt;/fs&gt;〕）和意志的（conative〔&lt;fs&gt;意動的&lt;/fs&gt;〕）。〔&lt;fs&gt;中括號內的標註是採取臺灣繁中版的亦非，以供參考。&lt;/fs&gt;〕&lt;/p&gt;
&lt;p&gt;前三位是睿知的，後二位是情意的（或意志的）。中間位即第三位，是睿知開始轉入意志，知識開始轉入生命之轉捩點——「道」有了血肉，抽象的觀念變形為一個會感覺、會意欲、會希望、會痛苦而能夠去做一切工作的活生生的人。&lt;/p&gt;
&lt;p&gt;後二位的第一位，禪者盡其最大努力在現實中去實現他所證見的道理。在最後一步，他達到了終點，而這其實是沒有終點。&lt;/p&gt;
&lt;p&gt;正偏如陰陽，構成兩極。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;正：即「正」、「直」、「公」、「平」&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;絕對（the absolute）&lt;/li&gt;
&lt;li&gt;無限（the infinite）&lt;/li&gt;
&lt;li&gt;一（the one）&lt;/li&gt;
&lt;li&gt;神（God）&lt;/li&gt;
&lt;li&gt;暗（dark 未分［undifferentiation］）&lt;/li&gt;
&lt;li&gt;平等（sameness）&lt;/li&gt;
&lt;li&gt;空（emptiness）&lt;/li&gt;
&lt;li&gt;智慧／般若（the universal）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;偏：即「片面」、「差別」、「不平衡」&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;相對（the relative）&lt;/li&gt;
&lt;li&gt;有限（the finite）&lt;/li&gt;
&lt;li&gt;多（the many）&lt;/li&gt;
&lt;li&gt;世界（the world）&lt;/li&gt;
&lt;li&gt;明（light 已分［differentiated］）&lt;/li&gt;
&lt;li&gt;差別（difference）&lt;/li&gt;
&lt;li&gt;名相（form and matter）&lt;/li&gt;
&lt;li&gt;愛／慈悲（love）&lt;/li&gt;
&lt;li&gt;事、個體（the particular）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;正中偏&lt;/h2&gt;
&lt;p&gt;「正裏面的偏」，意謂那寓含在多中的一，世界中的神，有限中的無限。當我們思想時，正與偏是相對的，不能調和。但事實是，正既不能獨自為正，偏亦不能獨自為偏。使多（偏）之為多的，是因為一在其中。&lt;/p&gt;
&lt;h2&gt;偏中正&lt;/h2&gt;
&lt;p&gt;「偏裏面的正」，補充上一點。若一在多中，多必然也在一中。多是使一成其為可能的。正如上帝不可存在於世界之外。&lt;/p&gt;
&lt;h2&gt;正中來&lt;/h2&gt;
&lt;p&gt;在此處，前二位的睿知現在變為意志，人變成了一個活生生的、有感情有意志的人。在此之前，他僅具有知性，僅具有頭腦；而現在，他具有了身軀，和身軀中的一切腑臟及肢體——特別是他的手，甚至像觀音菩薩般可擴充至一千（象徵無限）。而在他內在的生命中，他覺得像佛陀出世時所說的話一樣：「&lt;k&gt;上天下地，唯我獨尊。&lt;/k&gt;」&lt;/p&gt;
&lt;p&gt;馬丁·路德曾說：「&lt;em&gt;我站在此地，我唯有如此。（Here I stand; I can do no other.）&lt;/em&gt;」當百丈懷海被人問道：「如何是奇特事？」曰：「獨坐大雄峰」（此公案之詮解，可見於 &lt;a href=&quot;http://buddhaspace.org/dict/fk/data/%25E7%2599%25BE%25E4%25B8%2588%25E7%258D%25A8%25E5%259D%2590%25E5%25A4%25A7%25E9%259B%2584%25E5%25B3%25B0.html&quot;&gt;此處&lt;/a&gt;）。&lt;/p&gt;
&lt;p&gt;「我」必然是某種真實的東西（I think, Ergo I am），因為它就「在此」——在此，正與偏結合為活生生的矛盾之合一體。「我」所具有的一切力量都是從這個合一體而來。&lt;/p&gt;
&lt;p&gt;「正中來」之「正」非同於正中偏或偏中正之正。此「正」須和後面的「中」連唸，即「正中」，意謂「從正（而正即偏）與偏「而偏即正」中直接而來」。因此，整句意謂：「從正與偏的矛盾之合一中直接出來的人」。&lt;/p&gt;
&lt;p&gt;以 A 代表正、B 代表偏，則第三位可表示為下圖：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1-bc4248ad15be1ead2cd87236994b0688-b47a2.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 228px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 80.70175438596492%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3gUD/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAAMBAQAAAAAAAAAAAAAAAQAQESGB/9oACAEBAAE/IVg9xpN8md1r/9oADAMBAAIAAwAAABCwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAQACAwAAAAAAAAAAAAAAAAERMQAQQf/aAAgBAQABPxBhAtxDuSTU4e0wdSaNf//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;1&quot;
        title=&quot;&quot;
        src=&quot;/static/1-bc4248ad15be1ead2cd87236994b0688-b47a2.jpg&quot;
        srcset=&quot;/static/1-bc4248ad15be1ead2cd87236994b0688-b47a2.jpg 228w&quot;
        sizes=&quot;(max-width: 228px) 100vw, 228px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;注意到這兩個箭頭不是直線而是曲線，而且形成一個圓環，因為這個運動不是機械式的，而是活生生的、創造性的、無窮盡的。&lt;/p&gt;
&lt;p&gt;「正中來」之「來」亦深具意義，它與第四位「兼中至」之「至」同等重要。「來」者「出來」，而「至」意謂「到達目的之歷程」或「正在移向目標」。邏輯性的抽象物 &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E9%82%8F%E5%90%84%E6%96%AF&quot;&gt;Logos&lt;/a&gt;（道）現在步出樊籬，而化身為人，直接步入紛紜萬象的世界。&lt;/p&gt;
&lt;p&gt;祂（亦即「我」）同時是有限的和無限的，不居的又是恆久的，受限制的又是自由的，絕對的又是相對的。&lt;/p&gt;
&lt;p&gt;有些哲學家和神學家，把東方的「沉默」同西方的（充荷着力量，展用權柄和命令的）Logos（道）——這個「道」化成了肉身——相對比。他們未嘗瞭解到，東方的「沉默」真意何在，因為它並不與「道」相對立，而是道的本身。它是那「如雷般的沉默」，而非沈入空無深淵的沉默，亦非那落入死亡之永恆沙漠的沉默。東方的沉默，猶似颶風眼；它是風暴的中心，沒有它，颶風的移動就不可能。把這個不動的中心同它的週遭分開，是把它概念化，而毀壞了其意義。颶風眼是使得颱風成其為可能的東西。眼與颶風互相結合而構成颶風整體。&lt;/p&gt;
&lt;p&gt;以二元論觀點思考的人，往往偏重於動的一面或可見的一面，而忽略其他一切。譬如西方的芭蕾舞與日本的「能」，後者的靜定、莊嚴令西方人難以欣賞——舞者的重心放在腹部、腳步穩穩落在地面，他從花道步出，步向凝視着他的觀眾。他動而未動，表現出老子的無為之為。&lt;/p&gt;
&lt;p&gt;故禪者永遠不是顯目的，他總是自我隱沒的、全然不矯作的。當他宣稱自己為「至尊者」時，在他的外在沒有任何形跡顯露出他的內在生活。他是不動之動者。而事實上，那正是真正的「我」出現之處——那個在無限中發現其自身的「我」。這個「我」是吾輩最安全的基地，是吾輩都可以在自身中發現的；在這個基地上，吾輩都可以沒有懼怕，沒有焦慮，沒有猶豫不決的折磨。這個「我」幾乎可以被人以為根本沒有它的存在，因為它毫不跋扈，它從不喧鬧地要求被人認知、被人重視。&lt;/p&gt;
&lt;p&gt;蘇利文（Harry Stack Sullivan）認為焦慮可分成精神官能性的（neurotic）焦慮與存在的（existential）焦慮，且後者是更為基本的焦慮；當這基本焦慮解除之後，精神官能性焦慮即不治自癒。所有的焦慮，其起源都是由於在我們的意識中感到對我們的處境不完全知悉，這一種知識的缺乏導致不安全感，並因之產生各種程度的焦慮。不論我們遭遇的是何種處境，這個「我」都是此處境的中心。因此，當我們對「我」不能徹底知悉時，諸如下面的想法與問題就會不斷折磨我們：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;「生命有甚麼意義？」&lt;/li&gt;
&lt;li&gt;「所有的一切當真乃『虛空的虛空』嗎？設若如此，是否還有希望去抓到那真正值得追求的東西？」&lt;/li&gt;
&lt;li&gt;「我被丟進這殘酷的現實漩渦中，一切都是受擺佈的，一切都是被限制的，一切都是絕對無法更改的。我多麼無助！我祇是命運的玩偶。然而我渴望自由；我要做自己的主宰，我無法為自己做抉擇，然而不管怎麼樣，我卻非做選擇不行。我不知如何是好。但是，在這一切困惑人、折磨人的問題後面的那個『我』又是誰呢？」&lt;/li&gt;
&lt;li&gt;「何處是安全的地方，可以讓我沒有焦慮之感呢？或者，甚麼是『我』？因為，我知道，『我』可能就是那安全之處。這難道竟是我到現在還沒有找到的嗎？我一定得找到這個『我』，然後就一切都安然了！」&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;當到達第四位「兼中至」時，吾輩對這個「我」就知道得更多，對其強烈的行為亦知道得更多——然而，這行為卻是「無為」。&lt;/p&gt;
&lt;h2&gt;兼中至&lt;/h2&gt;
&lt;p&gt;當禪者的心靈還處於邏輯或認知狀態時，他仍舊會意識到正與偏，唯已能夠視其為矛盾的統一。&lt;strong&gt;但當進入「兼中至」時，他業已從颶風眼中走出，而投身入風暴之中。正與偏此時一同拋卻，他現在自己即是風暴。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;「兼」意為「兩者」，既是黑又是白；既是黑暗又是光明；既是愛又是恨；既是善又是惡——而這乃是禪者現在生活於其間的世界之實況。「正中來」仍殘留著第一、二位的餘跡，但「兼中至」則已完全把它們丟在背後，因為現在生命自身把一切智性上的困惑悉行剪斷——它現在無所區別地、整體地包容了睿知的與意志的一切事物。禪者現在直接「落足」（至）於這個世界。他真真實實的生活於焉開始。&lt;/p&gt;
&lt;p&gt;「兼中至」的意義乃是：「他現在步入二元世界（兼）之中。」禪者的慈悲生活現在是真真實實開始了。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;「趙州因僧問：『久嚮趙州石橋，到來祇見略彴〔&lt;fs&gt;破木橋&lt;/fs&gt;〕。』師曰：『汝祇見略彴，且不見石橋。』曰：『如何是石橋？』師曰：『度驢度馬。』」&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;禪者的第四位正像趙州從諗的石橋，當他的左臉已經被打，他可能不會把右臉也轉過來，但他卻為了人類同胞之福利默默地工作著。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;「官人問：『和尚還入地獄否？』師曰：『老僧末上入。』曰：『大善知識，為甚麼入地獄？』師曰：『老僧若不入，阿誰教化汝？』 」&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;基督說：「&lt;k&gt;我就是道路。&lt;/k&gt;」祂召喚別人從祂得救。趙州的精神與基督同。二者都沒有驕橫的自我中心精神，他們都祇是樸直地、全心全意地表白他們的愛之精神。&lt;/p&gt;
&lt;p&gt;菩薩或禪者的六種德行——名曰六波羅密：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;佈施（Dana）：為眾生福祉，給予一切自己所能夠給予的，包括物質和知識&lt;/li&gt;
&lt;li&gt;持戒（Sila）：戒律有助德性生活&lt;/li&gt;
&lt;li&gt;忍辱（Ksanti）：沉靜地去做謙卑的事情&lt;/li&gt;
&lt;li&gt;精進（Virya）：恆久熱忱地獻身於與法相合的每件事物&lt;/li&gt;
&lt;li&gt;禪定（Dhyana）：在任何環境下都保持心的平靜，不被逆境所騷擾、挫折&lt;/li&gt;
&lt;li&gt;般若（Prajna）：&lt;strong&gt;般若是當一個人以最基本的意義感受到諸事物之無限整體時的經驗，用心理學的方式說，就是當有限的自我突破了它的硬殼，而將它自己同那無限相關連時的經驗——這無限包括了一切有限之物，因之亦包括了一切瞬時變遷的事物。這種經驗相類於對於某種事物的整體直觀，這種直觀超出了我們所有個殊化的、特定化的經驗。&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;兼中到&lt;/h2&gt;
&lt;p&gt;臨濟對他的「無位真人」所作的描繪：「他在屋裏而又未離路途，他在路途而又未離屋子。」&lt;/p&gt;
&lt;p&gt;「至」尚未完成「到達」的動作，行者尚在路上；而「到」則表示禪者業已達到了他的目的和最終境地。他仍像以往一樣不屈不撓地工作；他同他的同胞一同留在世上。他的日常生活並未改變，改變了的祇是他的主體。他外在的行為並不是顯赫的；他完全沉入在內在生活中。&lt;/p&gt;
&lt;p&gt;本文錄自鈴木大拙《悟性的提升》並改寫&lt;/p&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Meister Eckhart 就人的進化之六階段]]></title><description><![CDATA[古時著名神學家、神祕主義者埃克哈特大師就人如何成為神人，即如何接近上帝乃至成為上帝，提出了六個階段。]]></description><link>https://lumen.netlify.com/posts/meister-echkhart-six-stages/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/meister-echkhart-six-stages/</guid><pubDate>Sat, 21 Apr 2018 22:12:03 GMT</pubDate><content:encoded>&lt;p&gt;神聖羅馬帝國的神學家、哲學家和神祕主義者——埃克哈特大師（Meister Eckhart, 1260-c1328）的思想是：上帝（The One）瀰漫於宇宙，亦棲息於每個人的靈魂中。吾人須奮力從世俗之短暫事物解除開來，並自省內察以復歸根柢、復歸上帝。人於焉與上帝合一，神性即是一性（Oneness），人即是一（One），正同上帝即是一。&lt;/p&gt;
&lt;p&gt;埃克哈特大師在著作 &lt;i&gt;Liber Benedictus&lt;/i&gt;（&lt;i&gt;The Book of Benedictus&lt;/i&gt;，Benedictus 一詞意為對上帝的讚美、頌揚）中，曾把人（inner man or new man）的進化——從對於母親和父親的附著到充分的獨立與開悟——做如下的闡明：&lt;/p&gt;
&lt;p&gt;「在第一階段，如聖奧古斯丁 &lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; 所說，內在的人或新人追隨著善者與虔誠者的後塵。這時他仍舊是母親懷中的嬰兒。&lt;/p&gt;
&lt;p&gt;「在第二階段，他不再盲從善者的腳步，他熱切地追求正確的訓誨、神聖的智慧。他把背轉向人，而把臉轉向神，他離開了母親的膝蓋，他對著天上的父微笑。&lt;/p&gt;
&lt;p&gt;「在第三階段，他愈發同他的母親分離，離他母親的懷抱越來越遠。他逃脫了顧慮，拋開了懼怕。雖然他可以無畏地以粗鄙和不公正的態度來對待所有人，但這並不能使他滿足，因為在他對於神的愛中，他已經完全被善行的願望所充滿；神已使他如此篤定地生活於喜悅、崇高和愛中，以致凡是不合於神的，他都覺得沒有價值而可言。&lt;/p&gt;
&lt;p&gt;「在第四階段，他更成長並紮根在愛中、在神中。他歡迎任何掙扎、任何試探、敵意或者痛苦，並且是心甘情願的、歡歡喜喜的。&lt;/p&gt;
&lt;p&gt;「在第五階段，他處於和平中，享受著至高的、無可說明的智慧所給他的充實。&lt;/p&gt;
&lt;p&gt;「在第六階段，他被消解並改造進神的永恆性之中，他已達至充分的完美，而不再顧到短暫的事物與生命，他被吸引到神的形象中，而變成神之子。這是最高的階段，是永恆的安靜與至福，內在的人和新的人之盡頭是永恆生命。」&lt;/p&gt;
&lt;p&gt;Meister Eckhart, translation by C. de B. Evans London, John M. Watkins, 1952, II, 80 - 81&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;聖奧古斯丁：354－430 年，羅馬帝國神學家、哲學家。他借用新柏拉圖主義，奠定了基督教的哲學基礎。&lt;/p&gt;
&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[react-redux 與 Immutable 優化]]></title><description><![CDATA[使用 react-redux 時，確保你熟悉它在更新和賦值時所做的操作，以及 immutable、side effects 和 mutation 的概念，以防止意外的 mutation 降低了應用性能。]]></description><link>https://lumen.netlify.com/posts/react-redux-and-immutable/</link><guid isPermaLink="false">https://lumen.netlify.com/posts/react-redux-and-immutable/</guid><pubDate>Thu, 01 Sep 2016 23:46:37 GMT</pubDate><content:encoded>&lt;h2&gt;react-redux&lt;/h2&gt;
&lt;p&gt;兩個前提：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt; 默認返回 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;，即只要組件的狀態（&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;）發生改變，組件就會執行 &lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt; 函數進行重渲染。除非重寫 &lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt; 透過返回 &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; 阻止重渲染，或者讓組件直接繼承自 &lt;code class=&quot;language-text&quot;&gt;PureComponent&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PureComponent&lt;/code&gt; 的原理只不過代替你實現了 &lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt;：在函數內對當前和過去的 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 進行淺對比（即僅比較對象的引用而非比較對象每個屬性值）。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其實在 &lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt; 中實現了這套邏輯，對數據進行淺對比：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; connect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    todos&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    visibleTodos&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getVisibleTodos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;App&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt; 會假設 &lt;code class=&quot;language-text&quot;&gt;App&lt;/code&gt; 是一個 &lt;code class=&quot;language-text&quot;&gt;PureComponent&lt;/code&gt;，即對於唯一的 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 有唯一的渲染結果。故 &lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt; 首先會對根狀態（即上述代碼中 &lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt; 的第一個形參 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;）創建索引，進行淺對比，若對比結果一致則不對組件進行重渲染，否則繼續調用 &lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt; 函數；同時繼續對 &lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt; 返回的 &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt; 對象中每個屬性值（&lt;code class=&quot;language-text&quot;&gt;state.todos&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;getVisibleTodos(state)&lt;/code&gt; 值）創建索引。和 &lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt; 類似，只有當淺對比失敗，即索引發生變動時才會對封裝組件進行重渲染。&lt;/p&gt;
&lt;p&gt;只有 &lt;code class=&quot;language-text&quot;&gt;state.todos&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;getVisibleTodos(state)&lt;/code&gt; 值不變，那麼 &lt;code class=&quot;language-text&quot;&gt;App&lt;/code&gt; 組件就永不會重渲染。但注意下面的陷阱模式：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      todos&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      visibleTodos&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getVisibleTodos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;即使兩者不再變化，但由於每次 &lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt; 返回結果 &lt;code class=&quot;language-text&quot;&gt;{ data: { ... } }&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt; 都是新創建的字面量對象，導致淺對比失敗，&lt;code class=&quot;language-text&quot;&gt;App&lt;/code&gt; 依然會重渲染。&lt;/p&gt;
&lt;p&gt;其次是 &lt;code class=&quot;language-text&quot;&gt;combineReducers&lt;/code&gt;。Redux Store 鼓勵我們把狀態對象劃分為不同碎片（slices）或領域（domains，業務），並分別編寫 reducer 函數以管理其狀態，最後使用 &lt;code class=&quot;language-text&quot;&gt;combineReducers&lt;/code&gt; 將這些領域及其 reducer 關聯起來，拼裝成一個整體的 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;combineReducers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; todos&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; myTodoReducer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; myCounterReducer &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;combineReducers&lt;/code&gt; 會遍歷每一對領域（key 是領域名，value 是 reducer），對於每次遍歷：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;創建一個對當前碎片數據的引用&lt;/li&gt;
&lt;li&gt;調用 reducer 計算碎片數據的新狀態，並返回&lt;/li&gt;
&lt;li&gt;為 reducer 返回的新碎片數據創建新的引用，將新引用與當前數據進行淺對比，若對比失敗（意味著兩次引用不同，即 reducer 返回的是一個新對象），則將標識位 &lt;code class=&quot;language-text&quot;&gt;hasChanged&lt;/code&gt; 設為 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;遍歷完後，&lt;code class=&quot;language-text&quot;&gt;combineReducers&lt;/code&gt; 就得到一個新狀態對象，透過 &lt;code class=&quot;language-text&quot;&gt;hasChanged&lt;/code&gt; 標識位就能判斷出整體狀態是否發生更改，若為 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; 則新狀態會被返回給下游（下游指 &lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt; 及其更下游的介面組件）。&lt;/p&gt;
&lt;p&gt;綜上所述我們知道，&lt;strong&gt;當狀態需要發生更改時，務必讓相應的 reducer 函數始終返回新對象。&lt;/strong&gt;修改原有對象的屬性值然後返回，並不會觸發組件的重渲染。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 而非僅修改原對象：&lt;/span&gt;
state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; state&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Immutable Data 和 ImmutableJS&lt;/h2&gt;
&lt;p&gt;結上可知，無論是從 reducer 的定義上，還是從 Redux 的工作機制上，我們都走上了同一條 &lt;code class=&quot;language-text&quot;&gt;Object.assign&lt;/code&gt; 的模式，即不修改原狀態，只返回新狀態。可見 state 天生就是不可變異的（immutable）。&lt;/p&gt;
&lt;p&gt;使用 ImmutableJS 能實現幾類不可變異的數據結構，譬如 &lt;code class=&quot;language-text&quot;&gt;Map&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;List&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Map &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;immutable&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; person &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// 創建一個空對象&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; personWithAge &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; person&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;age&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 為 person 實例添加 age 屬性&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 調用 toJS() 打印出兩個實例&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;person&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toJS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {}，person 的屬性不變&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;personWithAge&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toJS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// { age: 20 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;在 Immutable 的數據結構中，當你想更改某個對象屬性時，你得到的永遠是一個新對象，而原對象不會變化。上述 reducer 中：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;count&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;count&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Immutable 的原理：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;有這樣一個 JavaScript 結構對象，根據 key 作為索引，組織成字典查找樹：
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1-240776bc643dadbcabb25db0b589d2a4-1caba.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 400px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 93.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAH3pwdEjZCwf//EABgQAAIDAAAAAAAAAAAAAAAAAAEQACAh/9oACAEBAAEFAqZAgF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAaEAEAAwEBAQAAAAAAAAAAAAABABExIRBB/9oACAEBAAE/IVqDXjyx1hq4GogvSBWfIYT/2gAMAwEAAgADAAAAEPMIgP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABoQAQEBAQEBAQAAAAAAAAAAAAERACExcbH/2gAIAQEAAT8QuAKvmen0sZ+4aXPqD0PmcBiwXvHNqwWnzCYPEyVR4Nz8t//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;image&quot;
        title=&quot;&quot;
        src=&quot;/static/1-240776bc643dadbcabb25db0b589d2a4-1caba.jpg&quot;
        srcset=&quot;/static/1-240776bc643dadbcabb25db0b589d2a4-38c71.jpg 240w,
/static/1-240776bc643dadbcabb25db0b589d2a4-1caba.jpg 400w&quot;
        sizes=&quot;(max-width: 400px) 100vw, 400px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/li&gt;
&lt;li&gt;假設此時你想修改 &lt;code class=&quot;language-text&quot;&gt;tea&lt;/code&gt; 屬性的值為 &lt;code class=&quot;language-text&quot;&gt;14&lt;/code&gt;，首先找到訪問到 &lt;code class=&quot;language-text&quot;&gt;tea&lt;/code&gt; 節點的關鍵路徑：
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-4cf8a.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 55.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAe8UQdsv/8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAQABBQJijyf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAACAwADAAAAAAAAAAAAAAABEQAQITFBgf/aAAgBAQABPyFlnMLH0TQtDAN9r//aAAwDAQACAAMAAAAQjw//xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAwEBPxCn/8QAFhEBAQEAAAAAAAAAAAAAAAAAERAh/9oACAECAQE/EDWf/8QAGxABAQACAwEAAAAAAAAAAAAAAREAECExsXH/2gAIAQEAAT8QYiRdKcGSiJQj3oGClPcMr191/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;image&quot;
        title=&quot;&quot;
        src=&quot;/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-d564d.jpg&quot;
        srcset=&quot;/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-865fd.jpg 240w,
/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-d40a0.jpg 480w,
/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-d564d.jpg 960w,
/static/2-665dcf1a08f3fbfff48f8b173e8b6a5c-4cf8a.jpg 1000w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/li&gt;
&lt;li&gt;然後將路徑上的節點複製出來，構建一棵一模一樣結構的樹，唯新樹的其他節點均是對原樹的引用：
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3-6a3d9e29c3fd90d027c227cbdac79a00-4cf8a.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 68.80000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHfkRQiT//EABgQAAMBAQAAAAAAAAAAAAAAAAABMQIQ/9oACAEBAAEFAuKMRmf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAgMAAAAAAAAAAAAAAAAAMQERQVGh/9oACAEBAAE/IZReIFGxC3wSf//aAAwDAQACAAMAAAAQcP8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEx/9oACAEDAQE/EEx//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEx/9oACAECAQE/EEx//8QAHBABAQEAAQUAAAAAAAAAAAAAAREAITFBUXHB/9oACAEBAAE/EGCuCnwyVnr6mMoBXzkQ8IEMCGkZ2V3/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;image&quot;
        title=&quot;&quot;
        src=&quot;/static/3-6a3d9e29c3fd90d027c227cbdac79a00-d564d.jpg&quot;
        srcset=&quot;/static/3-6a3d9e29c3fd90d027c227cbdac79a00-865fd.jpg 240w,
/static/3-6a3d9e29c3fd90d027c227cbdac79a00-d40a0.jpg 480w,
/static/3-6a3d9e29c3fd90d027c227cbdac79a00-d564d.jpg 960w,
/static/3-6a3d9e29c3fd90d027c227cbdac79a00-4cf8a.jpg 1000w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/li&gt;
&lt;li&gt;最後將新建的樹返回。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;完 :)&lt;/p&gt;</content:encoded></item></channel></rss>